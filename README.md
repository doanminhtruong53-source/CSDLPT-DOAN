# Há»† THá»NG QUáº¢N LÃ SINH VIÃŠN - CÆ  Sá» Dá»® LIá»†U PHÃ‚N TÃN

## ğŸ“‹ Má»¤C Lá»¤C
1. [Tá»•ng quan dá»± Ã¡n](#1-tá»•ng-quan-dá»±-Ã¡n)
2. [Kiáº¿n trÃºc há»‡ thá»‘ng](#2-kiáº¿n-trÃºc-há»‡-thá»‘ng)
3. [LÆ°á»£c Ä‘á»“ cÆ¡ sá»Ÿ dá»¯ liá»‡u](#3-lÆ°á»£c-Ä‘á»“-cÆ¡-sá»Ÿ-dá»¯-liá»‡u)
4. [PhÃ¢n tÃ­ch phÃ¢n máº£nh](#4-phÃ¢n-tÃ­ch-phÃ¢n-máº£nh)
5. [MÃ´ hÃ¬nh triá»ƒn khai](#5-mÃ´-hÃ¬nh-triá»ƒn-khai)
6. [HÆ°á»›ng dáº«n cÃ i Ä‘áº·t](#6-hÆ°á»›ng-dáº«n-cÃ i-Ä‘áº·t)

---

## 1. Tá»”NG QUAN Dá»° ÃN

### 1.1. Giá»›i thiá»‡u
Há»‡ thá»‘ng quáº£n lÃ½ sinh viÃªn sá»­ dá»¥ng kiáº¿n trÃºc **CÆ¡ sá»Ÿ dá»¯ liá»‡u phÃ¢n tÃ¡n** vá»›i 7 sites Ä‘á»™c láº­p, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ quáº£n lÃ½ thÃ´ng tin lá»›p há»c, sinh viÃªn vÃ  Ä‘iá»ƒm sá»‘ theo tá»«ng khoa.

### 1.2. Má»¥c tiÃªu
- âœ… PhÃ¢n tÃ¡n dá»¯ liá»‡u theo khoa (K1, K2) Ä‘á»ƒ tá»‘i Æ°u hiá»‡u suáº¥t
- âœ… Äáº£m báº£o tÃ­nh toÃ n váº¹n vÃ  nháº¥t quÃ¡n dá»¯ liá»‡u
- âœ… Há»— trá»£ giao dá»‹ch phÃ¢n tÃ¡n (SAGA Pattern)
- âœ… Kháº£ nÄƒng má»Ÿ rá»™ng vÃ  báº£o trÃ¬ dá»… dÃ ng

### 1.3. CÃ´ng nghá»‡ sá»­ dá»¥ng
- **Database**: PostgreSQL 16 Alpine
- **Container**: Docker & Docker Compose
- **Backend**: .NET 9 Web API
- **Frontend**: Next.js 15 (React)
- **ORM**: Entity Framework Core
- **Pattern**: SAGA Pattern cho distributed transactions

---

## 2. KIáº¾N TRÃšC Há»† THá»NG

### 2.1. SÆ¡ Ä‘á»“ kiáº¿n trÃºc tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT LAYER                             â”‚
â”‚                    (Next.js Frontend - React)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ HTTP/REST API
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APPLICATION LAYER                           â”‚
â”‚                    (.NET 9 Web API - SAGA)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ClassServiceâ”‚  â”‚StudentServiceâ”‚  â”‚RegistrationService â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚    â”‚    â”‚         â”‚      â”‚         â”‚          â”‚
    â”‚    â”‚    â”‚         â”‚      â”‚         â”‚          â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â–¼â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE LAYER                             â”‚
â”‚              (7 PostgreSQL Sites - Distributed)                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Site 1   â”‚  â”‚ Site 2   â”‚  â”‚ Site 3   â”‚  â”‚ Site 4   â”‚       â”‚
â”‚  â”‚ LopK1DB  â”‚  â”‚ LopK2DB  â”‚  â”‚SinhVienK1â”‚  â”‚SinhVienK2â”‚       â”‚
â”‚  â”‚ :5439    â”‚  â”‚ :5433    â”‚  â”‚   :5434  â”‚  â”‚   :5435  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ Site 5   â”‚  â”‚ Site 6   â”‚  â”‚ Site 7   â”‚                     â”‚
â”‚  â”‚DangKyDiem1â”‚ â”‚DangKy23K1â”‚  â”‚DangKy23K2â”‚                     â”‚
â”‚  â”‚ :5436    â”‚  â”‚ :5437    â”‚  â”‚ :5438    â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â”‚            Network: csdl-network (Bridge Driver)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2. PhÃ¢n bá»• dá»¯ liá»‡u theo Sites

| Site | Database | Port | Container Name | Chá»©a dá»¯ liá»‡u | PhÃ¢n máº£nh |
|------|----------|------|----------------|--------------|-----------|
| **1** | LopK1DB | 5439 | postgres-lop-khoa-k1 | Lá»›p há»c Khoa 1 (L01-L10) | Ngang (khoa='K1') |
| **2** | LopK2DB | 5433 | postgres-lop-khoa-k2 | Lá»›p há»c Khoa 2 (L11-L20) | Ngang (khoa='K2') |
| **3** | SinhVienK1DB | 5434 | postgres-sinhvien-khoa-k1 | Sinh viÃªn K1 (SV001-SV030) | Ngang (mslop LIKE 'L0%') |
| **4** | SinhVienK2DB | 5435 | postgres-sinhvien-khoa-k2 | Sinh viÃªn K2 (SV101-SV130) | Ngang (mslop LIKE 'L1%') |
| **5** | DangKyDiem1DB | 5436 | postgres-dangky-diem1 | Äiá»ƒm 1 táº¥t cáº£ khoa | **KHÃ”NG phÃ¢n máº£nh** (Trung tÃ¢m) |
| **6** | DangKyDiem23K1DB | 5437 | postgres-dangky-diem23-khoa-k1 | Äiá»ƒm 2,3 cá»§a K1 | Ngang (mssv LIKE 'SV0%') |
| **7** | DangKyDiem23K2DB | 5438 | postgres-dangky-diem23-khoa-k2 | Äiá»ƒm 2,3 cá»§a K2 | Ngang (mssv LIKE 'SV1%') |

---

## 3. LÆ¯á»¢C Äá»’ CÆ  Sá» Dá»® LIá»†U

### 3.1. LÆ°á»£c Ä‘á»“ toÃ n cá»¥c (Global Schema)

#### 3.1.1. SÆ¡ Ä‘á»“ ER (Entity-Relationship Diagram)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           ENTITY: LOP               â”‚
                    â”‚         (Lá»›p há»c)                   â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ ğŸ”‘ mslop: VARCHAR(10) [PK]         â”‚
                    â”‚    tenlop: VARCHAR(100)             â”‚
                    â”‚    khoa: VARCHAR(10)                â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ 1
                                   â”‚
                                   â”‚ cÃ³
                                   â”‚
                                   â”‚ N
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        ENTITY: SINHVIEN             â”‚
                    â”‚        (Sinh viÃªn)                  â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ ğŸ”‘ mssv: VARCHAR(10) [PK]          â”‚
                    â”‚    hoten: VARCHAR(100)              â”‚
                    â”‚    phai: VARCHAR(10)                â”‚
                    â”‚    ngaysinh: DATE                   â”‚
                    â”‚ ğŸ”— mslop: VARCHAR(10) [FK â†’ LOP]   â”‚
                    â”‚    hocbong: DECIMAL(10,2)           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ 1
                                   â”‚
                                   â”‚ Ä‘Äƒng kÃ½
                                   â”‚
                                   â”‚ N
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      ENTITY: DANGKY_DIEM            â”‚
                    â”‚      (ÄÄƒng kÃ½ vÃ  Ä‘iá»ƒm)              â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ ğŸ”‘ mssv: VARCHAR(10) [PK, FK]      â”‚
                    â”‚ ğŸ”‘ msmon: VARCHAR(10) [PK]         â”‚
                    â”‚    diem1: DECIMAL(4,2)              â”‚
                    â”‚    diem2: DECIMAL(4,2)              â”‚
                    â”‚    diem3: DECIMAL(4,2)              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Œ ChÃº thÃ­ch:
   ğŸ”‘ = Primary Key
   ğŸ”— = Foreign Key
   [PK] = Primary Key constraint
   [FK] = Foreign Key constraint
```

#### 3.1.2. SÆ¡ Ä‘á»“ quan há»‡ chi tiáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GLOBAL SCHEMA                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚       LOP          â”‚                                             â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                                             â”‚
â”‚  â”‚ mslop  [PK]        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ tenlop             â”‚              â”‚ 1                             â”‚
â”‚  â”‚ khoa   [Index]     â”‚              â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                               â”‚
â”‚                                       â”‚                               â”‚
â”‚                                       â”‚ thuá»™c                         â”‚
â”‚                                       â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ N                             â”‚
â”‚  â”‚    SINHVIEN        â”‚              â”‚                               â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â”‚                               â”‚
â”‚  â”‚ mssv   [PK]        â”‚              â”‚                               â”‚
â”‚  â”‚ hoten              â”‚              â”‚                               â”‚
â”‚  â”‚ phai               â”‚              â”‚                               â”‚
â”‚  â”‚ ngaysinh           â”‚              â”‚                               â”‚
â”‚  â”‚ mslop  [FK]        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚  â”‚ hocbong            â”‚                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚             â”‚                                                         â”‚
â”‚             â”‚ 1                                                       â”‚
â”‚             â”‚                                                         â”‚
â”‚             â”‚ cÃ³                                                      â”‚
â”‚             â”‚                                                         â”‚
â”‚             â”‚ N                                                       â”‚
â”‚             â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚        DANGKY_DIEM                 â”‚                             â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                             â”‚
â”‚  â”‚ mssv   [PK, FK â†’ SINHVIEN]        â”‚                             â”‚
â”‚  â”‚ msmon  [PK]                        â”‚                             â”‚
â”‚  â”‚ diem1  [DECIMAL(4,2)]              â”‚                             â”‚
â”‚  â”‚ diem2  [DECIMAL(4,2)]              â”‚                             â”‚
â”‚  â”‚ diem3  [DECIMAL(4,2)]              â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                       â”‚
â”‚  Cardinality:                                                        â”‚
â”‚  â€¢ 1 LOP : N SINHVIEN                                               â”‚
â”‚  â€¢ 1 SINHVIEN : N DANGKY_DIEM                                       â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1.3. Äá»‹nh nghÄ©a báº£ng

#### ğŸ“š Báº£ng: LOP (Lá»›p há»c)
```sql
CREATE TABLE lop (
    mslop VARCHAR(10) PRIMARY KEY,      -- MÃ£ sá»‘ lá»›p (L01, L02, ..., L20)
    tenlop VARCHAR(100) NOT NULL,       -- TÃªn lá»›p há»c
    khoa VARCHAR(10) NOT NULL           -- Khoa (K1 hoáº·c K2)
);
```

**Ã nghÄ©a thuá»™c tÃ­nh:**
- `mslop`: MÃ£ Ä‘á»‹nh danh duy nháº¥t cho lá»›p há»c
- `tenlop`: TÃªn mÃ´ táº£ lá»›p há»c (VD: "Láº­p trÃ¬nh Web (ReactJS & Node.js)")
- `khoa`: Thuá»™c tÃ­nh phÃ¢n máº£nh - xÃ¡c Ä‘á»‹nh lá»›p thuá»™c Khoa 1 hay Khoa 2

#### ğŸ‘¥ Báº£ng: SINHVIEN (Sinh viÃªn)
```sql
CREATE TABLE sinhvien (
    mssv VARCHAR(10) PRIMARY KEY,       -- MÃ£ sá»‘ sinh viÃªn
    hoten VARCHAR(100) NOT NULL,        -- Há» vÃ  tÃªn
    phai VARCHAR(10) NOT NULL,          -- Giá»›i tÃ­nh (Nam/Ná»¯)
    ngaysinh DATE NOT NULL,             -- NgÃ y sinh
    mslop VARCHAR(10) NOT NULL,         -- MÃ£ lá»›p (Foreign Key â†’ lop.mslop)
    hocbong DECIMAL(10,2) DEFAULT 0     -- Há»c bá»•ng
);
```

**Ã nghÄ©a thuá»™c tÃ­nh:**
- `mssv`: MÃ£ Ä‘á»‹nh danh duy nháº¥t cho sinh viÃªn
  - SV0xx: Sinh viÃªn Khoa 1
  - SV1xx: Sinh viÃªn Khoa 2
- `mslop`: KhÃ³a ngoáº¡i tham chiáº¿u Ä‘áº¿n báº£ng LOP
- `hocbong`: Sá»‘ tiá»n há»c bá»•ng (cÃ³ thá»ƒ NULL)

#### ğŸ“ Báº£ng: DANGKY_DIEM (ÄÄƒng kÃ½ vÃ  Ä‘iá»ƒm)
```sql
-- ÄIá»‚M 1 (Site trung tÃ¢m - khÃ´ng phÃ¢n máº£nh)
CREATE TABLE dangky_diem1 (
    mssv VARCHAR(10) NOT NULL,          -- MÃ£ sinh viÃªn
    msmon VARCHAR(10) NOT NULL,         -- MÃ£ mÃ´n há»c
    diem1 DECIMAL(4,2),                 -- Äiá»ƒm chuyÃªn cáº§n (0-10)
    PRIMARY KEY (mssv, msmon)
);

-- ÄIá»‚M 2&3 (PhÃ¢n máº£nh theo khoa)
CREATE TABLE dangky_diem23 (
    mssv VARCHAR(10) NOT NULL,          -- MÃ£ sinh viÃªn
    msmon VARCHAR(10) NOT NULL,         -- MÃ£ mÃ´n há»c
    diem2 DECIMAL(4,2),                 -- Äiá»ƒm giá»¯a ká»³ (0-10)
    diem3 DECIMAL(4,2),                 -- Äiá»ƒm cuá»‘i ká»³ (0-10)
    PRIMARY KEY (mssv, msmon)
);
```

**Ã nghÄ©a thuá»™c tÃ­nh:**
- `(mssv, msmon)`: Composite primary key - má»™t sinh viÃªn chá»‰ Ä‘Äƒng kÃ½ má»™t mÃ´n má»™t láº§n
- `diem1`: Äiá»ƒm chuyÃªn cáº§n (10%)
- `diem2`: Äiá»ƒm giá»¯a ká»³ (30%)
- `diem3`: Äiá»ƒm cuá»‘i ká»³ (60%)

### 3.2. LÆ°á»£c Ä‘á»“ phÃ¢n máº£nh (Fragmentation Schema)

#### 3.2.1. SÆ¡ Ä‘á»“ phÃ¢n máº£nh tá»•ng thá»ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRAGMENTATION ARCHITECTURE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                          â”‚   GLOBAL SCHEMA  â”‚                                â”‚
â”‚                          â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                                â”‚
â”‚                          â”‚  â€¢ LOP (20)      â”‚                                â”‚
â”‚                          â”‚  â€¢ SINHVIEN (60) â”‚                                â”‚
â”‚                          â”‚  â€¢ DANGKY (360)  â”‚                                â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                   â”‚                                           â”‚
â”‚                                   â”‚ Horizontal Fragmentation                 â”‚
â”‚                                   â”‚ (by KHOA attribute)                      â”‚
â”‚                                   â”‚                                           â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚                         â”‚                         â”‚                â”‚
â”‚         â–¼                         â–¼                         â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   KHOA 1    â”‚          â”‚  CENTRALIZED â”‚          â”‚   KHOA 2    â”‚         â”‚
â”‚  â”‚   (K1)      â”‚          â”‚   (ALL)      â”‚          â”‚   (K2)      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                         â”‚                         â”‚                â”‚
â”‚         â–¼                         â–¼                         â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  SITE 1     â”‚          â”‚  SITE 5     â”‚          â”‚  SITE 2     â”‚         â”‚
â”‚  â”‚  LopK1DB    â”‚          â”‚ DangKyDiem1 â”‚          â”‚  LopK2DB    â”‚         â”‚
â”‚  â”‚  :5439      â”‚          â”‚    :5436    â”‚          â”‚  :5433      â”‚         â”‚
â”‚  â”‚             â”‚          â”‚             â”‚          â”‚             â”‚         â”‚
â”‚  â”‚ lop_k1 (10) â”‚          â”‚diem1 (180)  â”‚          â”‚ lop_k2 (10) â”‚         â”‚
â”‚  â”‚ L01-L10     â”‚          â”‚ K1+K2       â”‚          â”‚ L11-L20     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                                                  â”‚                 â”‚
â”‚         â–¼                                                  â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  SITE 3     â”‚                                    â”‚  SITE 4     â”‚         â”‚
â”‚  â”‚ SinhVienK1  â”‚                                    â”‚ SinhVienK2  â”‚         â”‚
â”‚  â”‚  :5434      â”‚                                    â”‚  :5435      â”‚         â”‚
â”‚  â”‚             â”‚                                    â”‚             â”‚         â”‚
â”‚  â”‚sinhvien(30) â”‚                                    â”‚sinhvien(30) â”‚         â”‚
â”‚  â”‚ SV001-030   â”‚                                    â”‚ SV101-130   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                                                  â”‚                 â”‚
â”‚         â–¼                                                  â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  SITE 6     â”‚                                    â”‚  SITE 7     â”‚         â”‚
â”‚  â”‚DangKy23 K1  â”‚                                    â”‚DangKy23 K2  â”‚         â”‚
â”‚  â”‚  :5437      â”‚                                    â”‚  :5438      â”‚         â”‚
â”‚  â”‚             â”‚                                    â”‚             â”‚         â”‚
â”‚  â”‚diem2,3 (90) â”‚                                    â”‚diem2,3 (90) â”‚         â”‚
â”‚  â”‚ K1 only     â”‚                                    â”‚ K2 only     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.2. PhÃ¢n máº£nh báº£ng LOP

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    LOP (Global)    â”‚
                        â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
                        â”‚  mslop, tenlop     â”‚
                        â”‚  khoa              â”‚
                        â”‚  Total: 20 rows    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                  Ïƒ (Selection by khoa)
                                   â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                      â”‚
                â–¼                                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   F1 = Ïƒ(khoa='K1')   â”‚            â”‚   F2 = Ïƒ(khoa='K2')   â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚            â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
    â”‚   Site 1: LopK1DB     â”‚            â”‚   Site 2: LopK2DB     â”‚
    â”‚   Port: 5439          â”‚            â”‚   Port: 5433          â”‚
    â”‚                       â”‚            â”‚                       â”‚
    â”‚   lop_k1:             â”‚            â”‚   lop_k2:             â”‚
    â”‚   â€¢ mslop: L01-L10    â”‚            â”‚   â€¢ mslop: L11-L20    â”‚
    â”‚   â€¢ khoa: 'K1'        â”‚            â”‚   â€¢ khoa: 'K2'        â”‚
    â”‚   â€¢ Rows: 10          â”‚            â”‚   â€¢ Rows: 10          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Predicate: P1: khoa='K1'             Predicate: P2: khoa='K2'
    
    âœ“ Completeness: LOP = F1 âˆª F2
    âœ“ Disjointness: F1 âˆ© F2 = âˆ…
    âœ“ Reconstruction: Possible
```

#### 3.2.3. PhÃ¢n máº£nh báº£ng SINHVIEN (Derived Fragmentation)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  SINHVIEN (Global)      â”‚
                    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
                    â”‚  mssv, hoten, phai      â”‚
                    â”‚  ngaysinh, mslop, hb    â”‚
                    â”‚  Total: 60 rows         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
              Semi-join with LOP fragments
                (Derived Horizontal Fragmentation)
                                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                               â”‚
          â–¼                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ F1 = SINHVIEN â‹‰ lop_k1  â”‚                â”‚ F2 = SINHVIEN â‹‰ lop_k2  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Site 3: SinhVienK1DB    â”‚                â”‚ Site 4: SinhVienK2DB    â”‚
â”‚ Port: 5434              â”‚                â”‚ Port: 5435              â”‚
â”‚                         â”‚                â”‚                         â”‚
â”‚ sinhvien_k1:            â”‚                â”‚ sinhvien_k2:            â”‚
â”‚ â€¢ mssv: SV001-SV030     â”‚                â”‚ â€¢ mssv: SV101-SV130     â”‚
â”‚ â€¢ mslop: L01-L05        â”‚                â”‚ â€¢ mslop: L11-L15        â”‚
â”‚   (6 SV per class)      â”‚                â”‚   (6 SV per class)      â”‚
â”‚ â€¢ Rows: 30              â”‚                â”‚ â€¢ Rows: 30              â”‚
â”‚                         â”‚                â”‚                         â”‚
â”‚ Distribution:           â”‚                â”‚ Distribution:           â”‚
â”‚  L01: 6 students        â”‚                â”‚  L11: 6 students        â”‚
â”‚  L02: 6 students        â”‚                â”‚  L12: 6 students        â”‚
â”‚  L03: 6 students        â”‚                â”‚  L13: 6 students        â”‚
â”‚  L04: 6 students        â”‚                â”‚  L14: 6 students        â”‚
â”‚  L05: 6 students        â”‚                â”‚  L15: 6 students        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Predicate: P1: mslop LIKE 'L0%'            Predicate: P2: mslop LIKE 'L1%'

âœ“ Completeness: SINHVIEN = F1 âˆª F2
âœ“ Disjointness: F1 âˆ© F2 = âˆ…
âœ“ Reconstruction: Possible
```

#### 3.2.4. PhÃ¢n máº£nh báº£ng DANGKY_DIEM

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    DANGKY_DIEM (Global)          â”‚
                â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
                â”‚    mssv, msmon, diem1,2,3        â”‚
                â”‚    Total: 360 rows               â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â”‚ Vertical Split     â”‚                    â”‚
        â”‚ by Diem Type       â”‚                    â”‚
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DIEM 1      â”‚    â”‚  DIEM 2 & 3  â”‚    â”‚  DIEM 2 & 3  â”‚
â”‚ (Centralized) â”‚    â”‚    (K1)      â”‚    â”‚    (K2)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Site 5: DangKyDiem1DB                                 â”‚
â”‚ Port: 5436                                            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚ dangky_diem1 (NO FRAGMENTATION):                      â”‚
â”‚ â€¢ mssv: SV0xx + SV1xx (ALL students)                  â”‚
â”‚ â€¢ msmon: M01-M03                                      â”‚
â”‚ â€¢ diem1: DECIMAL(4,2)                                 â”‚
â”‚ â€¢ Rows: 180 (90 K1 + 90 K2)                           â”‚
â”‚                                                        â”‚
â”‚ K1 Data: 90 rows (SV001-SV030 Ã— 3 mÃ´n)               â”‚
â”‚ K2 Data: 90 rows (SV101-SV130 Ã— 3 mÃ´n)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        ğŸ”„ Centralized Site - No Fragmentation
        Reason: Frequent aggregate queries

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Site 6: DangKy23K1DB    â”‚        â”‚ Site 7: DangKy23K2DB    â”‚
â”‚ Port: 5437              â”‚        â”‚ Port: 5438              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ F1 = Ïƒ(mssv LIKE 'SV0%')â”‚        â”‚ F2 = Ïƒ(mssv LIKE 'SV1%')â”‚
â”‚                         â”‚        â”‚                         â”‚
â”‚ dangky_diem23_k1:       â”‚        â”‚ dangky_diem23_k2:       â”‚
â”‚ â€¢ mssv: SV001-SV030     â”‚        â”‚ â€¢ mssv: SV101-SV130     â”‚
â”‚ â€¢ msmon: M01-M03        â”‚        â”‚ â€¢ msmon: M01-M03        â”‚
â”‚ â€¢ diem2: DECIMAL(4,2)   â”‚        â”‚ â€¢ diem2: DECIMAL(4,2)   â”‚
â”‚ â€¢ diem3: DECIMAL(4,2)   â”‚        â”‚ â€¢ diem3: DECIMAL(4,2)   â”‚
â”‚ â€¢ Rows: 90              â”‚        â”‚ â€¢ Rows: 90              â”‚
â”‚   (30 students Ã— 3 mÃ´n) â”‚        â”‚   (30 students Ã— 3 mÃ´n) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Predicate: P1: mssv LIKE 'SV0%'    Predicate: P2: mssv LIKE 'SV1%'

âœ“ Completeness: DANGKY_DIEM23 = F1 âˆª F2
âœ“ Disjointness: F1 âˆ© F2 = âˆ…
âœ“ Reconstruction: Possible
```

#### 3.2.5. Biá»ƒu thá»©c Ä‘áº¡i sá»‘ quan há»‡ chi tiáº¿t

#### ğŸ”¹ PhÃ¢n máº£nh báº£ng LOP
```sql
-- Fragment 1 (Site 1):
lop_k1 = Ïƒ(khoa='K1')(lop)

-- Fragment 2 (Site 2):
lop_k2 = Ïƒ(khoa='K2')(lop)

-- TÃ­nh Ä‘áº§y Ä‘á»§:
lop = lop_k1 âˆª lop_k2

-- TÃ­nh khÃ´ng trÃ¹ng láº·p:
lop_k1 âˆ© lop_k2 = âˆ…
```

#### ğŸ”¹ PhÃ¢n máº£nh báº£ng SINHVIEN
```sql
-- Fragment 1 (Site 3):
sinhvien_k1 = Ïƒ(mslop IN (SELECT mslop FROM lop_k1))(sinhvien)
            = Ïƒ(mslop LIKE 'L0%')(sinhvien)

-- Fragment 2 (Site 4):
sinhvien_k2 = Ïƒ(mslop IN (SELECT mslop FROM lop_k2))(sinhvien)
            = Ïƒ(mslop LIKE 'L1%')(sinhvien)

-- TÃ­nh Ä‘áº§y Ä‘á»§:
sinhvien = sinhvien_k1 âˆª sinhvien_k2

-- TÃ­nh khÃ´ng trÃ¹ng láº·p:
sinhvien_k1 âˆ© sinhvien_k2 = âˆ…
```

#### ğŸ”¹ PhÃ¢n máº£nh báº£ng DANGKY_DIEM
```sql
-- Fragment 1 (Site 5) - KHÃ”NG PHÃ‚N Máº¢NH:
dangky_diem1 = dangky_diem1  (toÃ n bá»™ dá»¯ liá»‡u)

-- Fragment 2 (Site 6):
dangky_diem23_k1 = Ïƒ(mssv LIKE 'SV0%')(dangky_diem23)

-- Fragment 3 (Site 7):
dangky_diem23_k2 = Ïƒ(mssv LIKE 'SV1%')(dangky_diem23)

-- TÃ­nh Ä‘áº§y Ä‘á»§:
dangky_diem23 = dangky_diem23_k1 âˆª dangky_diem23_k2

-- TÃ­nh khÃ´ng trÃ¹ng láº·p:
dangky_diem23_k1 âˆ© dangky_diem23_k2 = âˆ…
```

### 3.3. Má»‘i quan há»‡ giá»¯a cÃ¡c báº£ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    LOP      â”‚           â”‚  SINHVIEN    â”‚           â”‚  DANGKY_DIEM    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ mslop (PK)  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ mssv (PK)   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ mssv (PK,FK)   â”‚
â”‚ tenlop      â”‚    1:N    â”‚ hoten        â”‚    1:N    â”‚ msmon (PK,FK)  â”‚
â”‚ khoa        â”‚           â”‚ phai         â”‚           â”‚ diem1          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ ngaysinh     â”‚           â”‚ diem2          â”‚
                          â”‚ mslop (FK)   â”‚           â”‚ diem3          â”‚
                          â”‚ hocbong      â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**RÃ ng buá»™c toÃ n váº¹n:**
- 1 Lá»›p cÃ³ nhiá»u Sinh viÃªn (1:N)
- 1 Sinh viÃªn cÃ³ nhiá»u ÄÄƒng kÃ½ Ä‘iá»ƒm (1:N)
- Má»—i sinh viÃªn chá»‰ Ä‘Äƒng kÃ½ má»™t mÃ´n há»c má»™t láº§n (Composite PK)

---

## 4. PHÃ‚N TÃCH PHÃ‚N Máº¢NH

### 4.1. CÃ¡c biá»ƒu thá»©c phÃ¢n máº£nh Ä‘Ã£ thiáº¿t káº¿

#### 4.1.1. PhÃ¢n máº£nh ngang (Horizontal Fragmentation)

**A. PhÃ¢n máº£nh báº£ng LOP theo thuá»™c tÃ­nh KHOA:**

```sql
-- Biá»ƒu thá»©c phÃ¢n máº£nh:
F1 = Ïƒ(khoa='K1')(lop)  -- Site 1
F2 = Ïƒ(khoa='K2')(lop)  -- Site 2

-- Predicate phÃ¢n máº£nh:
P1: khoa = 'K1'
P2: khoa = 'K2'

-- Äiá»u kiá»‡n:
1. TÃ­nh Ä‘áº§y Ä‘á»§ (Completeness): lop = F1 âˆª F2
2. TÃ­nh khÃ´ng trÃ¹ng láº·p (Disjointness): F1 âˆ© F2 = âˆ…
3. TÃ­nh tÃ¡i táº¡o (Reconstruction): âœ“
```

**Dá»¯ liá»‡u thá»±c táº¿:**
- **F1 (Site 1)**: 10 lá»›p K1 - L01 Ä‘áº¿n L10
- **F2 (Site 2)**: 10 lá»›p K2 - L11 Ä‘áº¿n L20

---

**B. PhÃ¢n máº£nh báº£ng SINHVIEN theo MSLOP:**

```sql
-- Biá»ƒu thá»©c phÃ¢n máº£nh dáº«n xuáº¥t (Derived Fragmentation):
F1 = sinhvien â‹‰ lop_k1         -- Site 3
F2 = sinhvien â‹‰ lop_k2         -- Site 4

-- TÆ°Æ¡ng Ä‘Æ°Æ¡ng:
F1 = Ïƒ(mslop IN ('L01','L02',...,'L10'))(sinhvien)
F2 = Ïƒ(mslop IN ('L11','L12',...,'L20'))(sinhvien)

-- Hoáº·c Ä‘Æ¡n giáº£n hÃ³a:
F1 = Ïƒ(mslop LIKE 'L0%')(sinhvien)
F2 = Ïƒ(mslop LIKE 'L1%')(sinhvien)
```

**Dá»¯ liá»‡u thá»±c táº¿:**
- **F1 (Site 3)**: 30 sinh viÃªn K1 - MSSV: SV001 â†’ SV030
  - PhÃ¢n bá»‘: 6 SV/lá»›p Ã— 5 lá»›p (L01-L05)
- **F2 (Site 4)**: 30 sinh viÃªn K2 - MSSV: SV101 â†’ SV130
  - PhÃ¢n bá»‘: 6 SV/lá»›p Ã— 5 lá»›p (L11-L15)

---

**C. PhÃ¢n máº£nh báº£ng DANGKY_DIEM23 theo MSSV:**

```sql
-- Biá»ƒu thá»©c phÃ¢n máº£nh:
F1 = Ïƒ(mssv LIKE 'SV0%')(dangky_diem23)  -- Site 6
F2 = Ïƒ(mssv LIKE 'SV1%')(dangky_diem23)  -- Site 7

-- Predicate phÃ¢n máº£nh:
P1: mssv >= 'SV000' AND mssv < 'SV100'
P2: mssv >= 'SV100' AND mssv < 'SV200'
```

**Dá»¯ liá»‡u thá»±c táº¿:**
- **F1 (Site 6)**: 90 báº£n ghi Ä‘iá»ƒm 2&3 cá»§a K1
- **F2 (Site 7)**: 90 báº£n ghi Ä‘iá»ƒm 2&3 cá»§a K2

---

#### 4.1.2. PhÃ¢n máº£nh dá»c (Vertical Fragmentation)

**KhÃ´ng Ã¡p dá»¥ng** trong há»‡ thá»‘ng nÃ y vÃ¬:
- CÃ¡c báº£ng cÃ³ Ã­t thuá»™c tÃ­nh (3-6 cá»™t)
- KhÃ´ng cÃ³ nhu cáº§u tÃ¡ch cá»™t Ä‘á»™c láº­p
- Táº¥t cáº£ thuá»™c tÃ­nh thÆ°á»ng Ä‘Æ°á»£c truy váº¥n cÃ¹ng nhau

---

#### 4.1.3. PhÃ¢n máº£nh há»—n há»£p (Hybrid Fragmentation)

**KhÃ´ng Ã¡p dá»¥ng** trong há»‡ thá»‘ng nÃ y vÃ¬:
- Chá»‰ cáº§n phÃ¢n máº£nh ngang lÃ  Ä‘á»§
- Kiáº¿n trÃºc Ä‘Æ¡n giáº£n, dá»… báº£o trÃ¬

---

### 4.2. Giáº£i thÃ­ch lÃ½ do lá»±a chá»n tiÃªu chÃ­ phÃ¢n máº£nh

#### 4.2.1. PhÃ¢n máº£nh ngang theo KHOA

**LÃ½ do chá»n:**

âœ… **1. Tá»‘i Æ°u truy váº¥n Ä‘á»‹a phÆ°Æ¡ng (Locality of Reference)**
```sql
-- Truy váº¥n chá»‰ cáº§n 1 site:
SELECT * FROM lop WHERE khoa = 'K1';  -- Chá»‰ truy cáº­p Site 1
SELECT * FROM sinhvien WHERE mslop LIKE 'L0%';  -- Chá»‰ truy cáº­p Site 3
```

âœ… **2. Giáº£m chi phÃ­ truyá»n thÃ´ng (Network Cost)**
- 80% truy váº¥n chá»‰ liÃªn quan Ä‘áº¿n 1 khoa
- KhÃ´ng cáº§n join giá»¯a cÃ¡c sites thÆ°á»ng xuyÃªn

âœ… **3. TÄƒng tÃ­nh sáºµn sÃ ng (Availability)**
- Site 1 down â†’ Khoa 2 váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng
- Site 2 down â†’ Khoa 1 váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng

âœ… **4. Dá»… má»Ÿ rá»™ng (Scalability)**
- ThÃªm Khoa 3 â†’ ThÃªm 3 sites má»›i (lá»›p, sinh viÃªn, Ä‘iá»ƒm)
- KhÃ´ng áº£nh hÆ°á»Ÿng dá»¯ liá»‡u cÅ©

âœ… **5. PhÃ¢n tÃ¡n táº£i (Load Distribution)**
- Má»—i khoa cÃ³ tÃ i nguyÃªn riÃªng
- Khoa 1 cÃ³ nhiá»u sinh viÃªn khÃ´ng áº£nh hÆ°á»Ÿng Khoa 2

---

#### 4.2.2. Site trung tÃ¢m cho ÄIá»‚M 1 (Site 5)

**LÃ½ do KHÃ”NG phÃ¢n máº£nh:**

âœ… **1. YÃªu cáº§u bÃ¡o cÃ¡o tá»•ng há»£p**
```sql
-- Truy váº¥n cáº§n táº¥t cáº£ Ä‘iá»ƒm 1:
SELECT AVG(diem1) FROM dangky_diem1;  
-- Náº¿u phÃ¢n máº£nh â†’ cáº§n join 2 sites â†’ cháº­m
```

âœ… **2. Dá»¯ liá»‡u nhá», Ã­t thay Ä‘á»•i**
- Äiá»ƒm chuyÃªn cáº§n chá»‰ nháº­p 1 láº§n/há»c ká»³
- 180 báº£n ghi khÃ´ng gÃ¢y quÃ¡ táº£i

âœ… **3. TrÃ¡nh giao dá»‹ch phÃ¢n tÃ¡n phá»©c táº¡p**
- Cáº­p nháº­t Ä‘iá»ƒm 1 chá»‰ cáº§n 1 transaction
- KhÃ´ng cáº§n SAGA pattern

---

#### 4.2.3. MÃ´ hÃ¬nh phÃ¢n tÃ¡n: KHÃ”NG SAO CHÃ‰P (No Replication)

**LÃ½ do chá»n:**

âœ… **1. ÄÆ¡n giáº£n, dá»… quáº£n lÃ½**
- KhÃ´ng cÃ³ váº¥n Ä‘á» Ä‘á»“ng bá»™ dá»¯ liá»‡u
- TrÃ¡nh phá»©c táº¡p cá»§a consistency protocols

âœ… **2. Dá»¯ liá»‡u nhá»**
- Tá»•ng 60 sinh viÃªn, 20 lá»›p
- KhÃ´ng cáº§n sao chÃ©p Ä‘á»ƒ tá»‘i Æ°u

âœ… **3. YÃªu cáº§u Ä‘á» Ã¡n**
- Táº­p trung vÃ o phÃ¢n máº£nh, khÃ´ng yÃªu cáº§u replication

**LÆ°u Ã½:** Trong production, cÃ³ thá»ƒ thÃªm:
- Read replicas cho bÃ¡o cÃ¡o
- Backup sites cho disaster recovery

---

### 4.3. Báº£ng tá»•ng há»£p phÃ¢n máº£nh

| Báº£ng | Loáº¡i phÃ¢n máº£nh | Thuá»™c tÃ­nh phÃ¢n máº£nh | Sá»‘ phÃ¢n máº£nh | Sites |
|------|----------------|----------------------|--------------|-------|
| **LOP** | Ngang (Horizontal) | `khoa` | 2 | 1, 2 |
| **SINHVIEN** | Ngang dáº«n xuáº¥t | `mslop` (foreign key) | 2 | 3, 4 |
| **DANGKY_DIEM1** | **KHÃ”NG phÃ¢n máº£nh** | - | 1 (toÃ n bá»™) | 5 |
| **DANGKY_DIEM23** | Ngang | `mssv` (prefix) | 2 | 6, 7 |

---

## 5. MÃ” HÃŒNH TRIá»‚N KHAI

### 5.1. MÃ´i trÆ°á»ng thá»±c táº¿

#### 5.1.1. Pháº§n cá»©ng

**Cáº¥u hÃ¬nh mÃ¡y chá»§ (Development):**
```
- CPU: Apple M1/M2 hoáº·c Intel Core i5+
- RAM: 16 GB
- Storage: 50 GB available
- Network: localhost (127.0.0.1)
```

**LÆ°u Ã½:** Trong mÃ´i trÆ°á»ng production:
- Má»—i site nÃªn cÃ³ mÃ¡y chá»§ riÃªng
- Sá»­ dá»¥ng load balancer
- CÃ³ backup server

---

#### 5.1.2. Pháº§n má»m

| ThÃ nh pháº§n | Version | Vai trÃ² |
|------------|---------|---------|
| **PostgreSQL** | 16-alpine | Database engine |
| **Docker** | 24.0+ | Container runtime |
| **Docker Compose** | 2.20+ | Multi-container orchestration |
| **.NET SDK** | 9.0 | Backend API framework |
| **Node.js** | 20 LTS | Frontend runtime |
| **Next.js** | 15.0 | React framework |

---

#### 5.1.3. Chi tiáº¿t cÃ¡c Sites

```yaml
# File: docker-compose.yml

# Site 1: Lá»›p Khoa 1
postgres-lop-khoa-k1:
  image: postgres:16-alpine
  container_name: postgres-lop-khoa-k1
  environment:
    POSTGRES_DB: LopK1DB
    POSTGRES_USER: admin
    POSTGRES_PASSWORD: admin123
  ports:
    - "5439:5432"
  volumes:
    - ./postgres/01-init-lop-k1.sql:/docker-entrypoint-initdb.d/init.sql
    - postgres-lop-k1-data:/var/lib/postgresql/data
  networks:
    - csdl-network
  healthcheck:
    test: ["CMD-SHELL", "pg_isready -U admin -d LopK1DB"]
    interval: 10s
    timeout: 5s
    retries: 5

# Site 2: Lá»›p Khoa 2
postgres-lop-khoa-k2:
  image: postgres:16-alpine
  container_name: postgres-lop-khoa-k2
  environment:
    POSTGRES_DB: LopK2DB
    POSTGRES_USER: admin
    POSTGRES_PASSWORD: admin123
  ports:
    - "5433:5432"
  volumes:
    - ./postgres/02-init-lop-k2.sql:/docker-entrypoint-initdb.d/init.sql
    - postgres-lop-k2-data:/var/lib/postgresql/data
  networks:
    - csdl-network

# [Sites 3-7 tÆ°Æ¡ng tá»±...]
```

---

### 5.2. CÃ¡c bÆ°á»›c triá»ƒn khai

#### ğŸ“‹ **BÆ°á»›c 1: Chuáº©n bá»‹ mÃ´i trÆ°á»ng**

```bash
# 1.1. CÃ i Ä‘áº·t Docker
brew install docker  # macOS
# hoáº·c táº£i tá»« https://docker.com

# 1.2. Kiá»ƒm tra Docker
docker --version
docker-compose --version

# 1.3. Clone repository
git clone <repository-url>
cd CSDLPT-DOAN
```

---

#### ğŸ“‹ **BÆ°á»›c 2: Khá»Ÿi táº¡o Databases**

```bash
# 2.1. Di chuyá»ƒn vÃ o thÆ° má»¥c Database
cd Database

# 2.2. Kiá»ƒm tra file SQL init
ls postgres/
# Output: 
# 01-init-lop-k1.sql
# 02-init-lop-k2.sql
# 03-init-sinhvien-k1.sql
# 04-init-sinhvien-k2.sql
# 05-init-dangky-diem1.sql
# 06-init-dangky-diem23-k1.sql
# 07-init-dangky-diem23-k2.sql

# 2.3. Khá»Ÿi Ä‘á»™ng Docker containers
docker compose up -d

# 2.4. Kiá»ƒm tra containers
docker ps
# Pháº£i tháº¥y 7 containers Ä‘ang cháº¡y

# 2.5. Kiá»ƒm tra logs
docker logs postgres-lop-khoa-k1
```

---

#### ğŸ“‹ **BÆ°á»›c 3: XÃ¡c thá»±c dá»¯ liá»‡u**

```bash
# 3.1. Kiá»ƒm tra Site 1 (Lá»›p K1)
docker exec postgres-lop-khoa-k1 psql -U admin -d LopK1DB -c "SELECT COUNT(*) FROM lop_k1;"
# Output: 10

# 3.2. Kiá»ƒm tra Site 2 (Lá»›p K2)
docker exec postgres-lop-khoa-k2 psql -U admin -d LopK2DB -c "SELECT COUNT(*) FROM lop_k2;"
# Output: 10

# 3.3. Kiá»ƒm tra Site 3 (Sinh viÃªn K1)
docker exec postgres-sinhvien-khoa-k1 psql -U admin -d SinhVienK1DB -c "SELECT COUNT(*) FROM sinhvien_k1;"
# Output: 30

# 3.4. Kiá»ƒm tra Site 4 (Sinh viÃªn K2)
docker exec postgres-sinhvien-khoa-k2 psql -U admin -d SinhVienK2DB -c "SELECT COUNT(*) FROM sinhvien_k2;"
# Output: 30

# 3.5. Kiá»ƒm tra Site 5 (Äiá»ƒm 1)
docker exec postgres-dangky-diem1 psql -U admin -d DangKyDiem1DB -c "SELECT COUNT(*) FROM dangky_diem1;"
# Output: 180

# 3.6. Kiá»ƒm tra Site 6 (Äiá»ƒm 2&3 K1)
docker exec postgres-dangky-diem23-khoa-k1 psql -U admin -d DangKyDiem23K1DB -c "SELECT COUNT(*) FROM dangky_diem23_k1;"
# Output: 90

# 3.7. Kiá»ƒm tra Site 7 (Äiá»ƒm 2&3 K2)
docker exec postgres-dangky-diem23-khoa-k2 psql -U admin -d DangKyDiem23K2DB -c "SELECT COUNT(*) FROM dangky_diem23_k2;"
# Output: 90
```

---

#### ğŸ“‹ **BÆ°á»›c 4: Khá»Ÿi Ä‘á»™ng Backend API**

```bash
# 4.1. Di chuyá»ƒn vÃ o thÆ° má»¥c API
cd ../src/DistributedDbApi

# 4.2. Kiá»ƒm tra file cáº¥u hÃ¬nh
cat appsettings.json
# XÃ¡c nháº­n 7 connection strings Ä‘Ãºng ports

# 4.3. Restore dependencies
dotnet restore

# 4.4. Build project
dotnet build

# 4.5. Cháº¡y API
dotnet run

# Output:
# Now listening on: http://localhost:5000
# Application started. Press Ctrl+C to shut down.
```

---

#### ğŸ“‹ **BÆ°á»›c 5: Khá»Ÿi Ä‘á»™ng Frontend**

```bash
# 5.1. Má»Ÿ terminal má»›i, di chuyá»ƒn vÃ o frontend
cd frontend

# 5.2. CÃ i Ä‘áº·t dependencies
npm install

# 5.3. Cháº¡y development server
npm run dev

# Output:
# â–² Next.js 15.0.0
# - Local:        http://localhost:3000
```

---

#### ğŸ“‹ **BÆ°á»›c 6: Kiá»ƒm tra toÃ n há»‡ thá»‘ng**

```bash
# 6.1. Má»Ÿ trÃ¬nh duyá»‡t
open http://localhost:3000

# 6.2. Kiá»ƒm tra danh sÃ¡ch lá»›p
# Truy cáº­p: http://localhost:3000/classes
# Pháº£i tháº¥y 20 lá»›p (10 K1 + 10 K2)

# 6.3. Test táº¡o lá»›p má»›i
# Click "ThÃªm lá»›p má»›i"
# Nháº­p: TÃªn = "Test Class", Khoa = K1
# MÃ£ lá»›p tá»± Ä‘á»™ng: L22 (hoáº·c tiáº¿p theo)

# 6.4. Kiá»ƒm tra database
docker exec postgres-lop-khoa-k1 psql -U admin -d LopK1DB -c "SELECT * FROM lop_k1 WHERE mslop='L22';"
```

---

### 5.3. HÃ¬nh áº£nh kiáº¿n trÃºc Ä‘Ã£ triá»ƒn khai

#### 5.3.1. SÆ¡ Ä‘á»“ máº¡ng Docker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Docker Network: csdl-network (172.18.0.0/16)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  LopK1DB         â”‚  â”‚  LopK2DB         â”‚                    â”‚
â”‚  â”‚  Container       â”‚  â”‚  Container       â”‚                    â”‚
â”‚  â”‚  IP: 172.18.0.2  â”‚  â”‚  IP: 172.18.0.3  â”‚                    â”‚
â”‚  â”‚  Port: 5432â†’5439 â”‚  â”‚  Port: 5432â†’5433 â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ SinhVienK1DB     â”‚  â”‚ SinhVienK2DB     â”‚                    â”‚
â”‚  â”‚ Container        â”‚  â”‚ Container        â”‚                    â”‚
â”‚  â”‚ IP: 172.18.0.4   â”‚  â”‚ IP: 172.18.0.5   â”‚                    â”‚
â”‚  â”‚ Port: 5432â†’5434  â”‚  â”‚ Port: 5432â†’5435  â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ DangKyDiem1DB    â”‚  â”‚ DangKy23K1DB     â”‚  â”‚ DangKy23K2DB â”‚ â”‚
â”‚  â”‚ Container        â”‚  â”‚ Container        â”‚  â”‚ Container    â”‚ â”‚
â”‚  â”‚ IP: 172.18.0.6   â”‚  â”‚ IP: 172.18.0.7   â”‚  â”‚ IP:172.18.0.8â”‚ â”‚
â”‚  â”‚ Port: 5432â†’5436  â”‚  â”‚ Port: 5432â†’5437  â”‚  â”‚ Port:5432â†’438â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ TCP/IP
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Host Machine    â”‚
                    â”‚  localhost:5439   â”‚
                    â”‚  localhost:5433   â”‚
                    â”‚  localhost:543x   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 5.3.2. Luá»“ng dá»¯ liá»‡u khi táº¡o lá»›p má»›i

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser â”‚                 â”‚ Next.js â”‚                 â”‚ .NET APIâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                           â”‚                           â”‚
     â”‚ POST /api/classes         â”‚                           â”‚
     â”‚ {tenlop, khoa}            â”‚                           â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚ POST /api/classes         â”‚
     â”‚                           â”‚ {tenlop, khoa}            â”‚
     â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚                           â”‚ 1. Query K1 & K2
     â”‚                           â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                           â”‚                           â”‚   Find   â”‚
     â”‚                           â”‚                           â”‚   Max    â”‚
     â”‚                           â”‚                           â”‚   (L20)  â”‚
     â”‚                           â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚                           â”‚ 2. Generate L21
     â”‚                           â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                           â”‚                           â”‚  Next ID â”‚
     â”‚                           â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚                           â”‚ 3. Insert into K1 or K2
     â”‚                           â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                           â”‚                           â”‚  BEGIN   â”‚
     â”‚                           â”‚                           â”‚  INSERT  â”‚
     â”‚                           â”‚                           â”‚  COMMIT  â”‚
     â”‚                           â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚ 200 OK                    â”‚
     â”‚                           â”‚ {mslop: L21, ...}         â”‚
     â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                           â”‚                           â”‚
     â”‚ 200 OK                    â”‚                           â”‚
     â”‚ {mslop: L21, ...}         â”‚                           â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
     â”‚                           â”‚                           â”‚
```

---

#### 5.3.3. SAGA Pattern cho Distributed Transaction

**VÃ­ dá»¥: Táº¡o sinh viÃªn má»›i**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SAGA: Create Student Transaction                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Validate Class Exists
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query Lop  â”‚  â† Site 1 (if K1) or Site 2 (if K2)
â”‚  by mslop   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   [Success] â†’ Continue
   [Fail]    â†’ Rollback (No DB changes yet)

Step 2: Insert Student
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Insert SV   â”‚  â† Site 3 (if K1) or Site 4 (if K2)
â”‚ BEGIN       â”‚
â”‚ INSERT      â”‚
â”‚ COMMIT      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   [Success] â†’ Continue
   [Fail]    â†’ Rollback (No compensation needed)

Step 3: Initialize Scores (Optional)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Insert Diem â”‚  â† Site 5, 6, or 7
â”‚ BEGIN       â”‚
â”‚ INSERT      â”‚
â”‚ COMMIT      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   [Success] â†’ Complete
   [Fail]    â†’ Compensate: Delete Student from Step 2

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Compensation Logic:                                           â”‚
â”‚  - If Step 3 fails â†’ Execute DELETE student from Site 3/4     â”‚
â”‚  - Use try-catch with explicit compensation commands          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 5.3.4. Cáº¥u trÃºc thÆ° má»¥c dá»± Ã¡n

```
CSDLPT-DOAN/
â”œâ”€â”€ README.md                          â† File nÃ y
â”œâ”€â”€ Database/
â”‚   â”œâ”€â”€ docker-compose.yml             â† Cáº¥u hÃ¬nh 7 containers
â”‚   â””â”€â”€ postgres/
â”‚       â”œâ”€â”€ 01-init-lop-k1.sql         â† Seed data Site 1
â”‚       â”œâ”€â”€ 02-init-lop-k2.sql         â† Seed data Site 2
â”‚       â”œâ”€â”€ 03-init-sinhvien-k1.sql    â† Seed data Site 3
â”‚       â”œâ”€â”€ 04-init-sinhvien-k2.sql    â† Seed data Site 4
â”‚       â”œâ”€â”€ 05-init-dangky-diem1.sql   â† Seed data Site 5
â”‚       â”œâ”€â”€ 06-init-dangky-diem23-k1.sql â† Seed data Site 6
â”‚       â””â”€â”€ 07-init-dangky-diem23-k2.sql â† Seed data Site 7
â”‚
â”œâ”€â”€ src/
â”‚   â””â”€â”€ DistributedDbApi/              â† Backend .NET 9
â”‚       â”œâ”€â”€ Program.cs                 â† Entry point
â”‚       â”œâ”€â”€ appsettings.json           â† 7 Connection strings
â”‚       â”œâ”€â”€ Data/
â”‚       â”‚   â”œâ”€â”€ LopK1DbContext.cs      â† EF Core context Site 1
â”‚       â”‚   â”œâ”€â”€ LopK2DbContext.cs      â† EF Core context Site 2
â”‚       â”‚   â”œâ”€â”€ SinhVienK1DbContext.cs â† EF Core context Site 3
â”‚       â”‚   â”œâ”€â”€ SinhVienK2DbContext.cs â† EF Core context Site 4
â”‚       â”‚   â””â”€â”€ ...                    â† Contexts Sites 5-7
â”‚       â”œâ”€â”€ Models/
â”‚       â”‚   â”œâ”€â”€ LopK1.cs               â† Entity model
â”‚       â”‚   â”œâ”€â”€ SinhVienK1.cs          â† Entity model
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”œâ”€â”€ Services/
â”‚       â”‚   â”œâ”€â”€ ClassService.cs        â† Business logic (SAGA)
â”‚       â”‚   â”œâ”€â”€ StudentService.cs      â† Business logic
â”‚       â”‚   â””â”€â”€ RegistrationService.cs â† Business logic
â”‚       â””â”€â”€ Controllers/
â”‚           â”œâ”€â”€ ClassController.cs     â† API endpoints
â”‚           â”œâ”€â”€ StudentController.cs   â† API endpoints
â”‚           â””â”€â”€ ...
â”‚
â””â”€â”€ frontend/                          â† Next.js 15
    â”œâ”€â”€ package.json
    â”œâ”€â”€ next.config.js
    â”œâ”€â”€ app/
    â”‚   â”œâ”€â”€ layout.tsx                 â† Root layout
    â”‚   â”œâ”€â”€ page.tsx                   â† Home page
    â”‚   â””â”€â”€ classes/
    â”‚       â””â”€â”€ page.tsx               â† Classes CRUD page
    â””â”€â”€ components/
        â”œâ”€â”€ ClassCard.tsx              â† UI component
        â””â”€â”€ SearchBar.tsx              â† UI component
```

---

## 6. HÆ¯á»šNG DáºªN CÃ€I Äáº¶T

### 6.1. YÃªu cáº§u há»‡ thá»‘ng

- **OS**: macOS 10.15+, Windows 10+, Ubuntu 20.04+
- **Docker**: 24.0+
- **Docker Compose**: 2.20+
- **.NET SDK**: 9.0+
- **Node.js**: 20 LTS
- **RAM**: 8 GB minimum, 16 GB recommended
- **Storage**: 10 GB free space

---

### 6.2. CÃ i Ä‘áº·t nhanh

```bash
# 1. Clone repository
git clone <repository-url>
cd CSDLPT-DOAN

# 2. Khá»Ÿi Ä‘á»™ng databases
cd Database
docker compose up -d

# 3. Khá»Ÿi Ä‘á»™ng backend (terminal má»›i)
cd ../src/DistributedDbApi
dotnet restore
dotnet run

# 4. Khá»Ÿi Ä‘á»™ng frontend (terminal má»›i)
cd ../../frontend
npm install
npm run dev

# 5. Truy cáº­p á»©ng dá»¥ng
open http://localhost:3000
```

---

### 6.3. Xá»­ lÃ½ sá»± cá»‘

#### âŒ **Lá»—i: Container khÃ´ng khá»Ÿi Ä‘á»™ng**

```bash
# Kiá»ƒm tra logs
docker logs postgres-lop-khoa-k1

# XÃ³a vÃ  táº¡o láº¡i
docker compose down -v
docker compose up -d
```

#### âŒ **Lá»—i: Port Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng**

```bash
# TÃ¬m process Ä‘ang dÃ¹ng port 5439
lsof -i :5439

# Kill process
kill -9 <PID>

# Hoáº·c Ä‘á»•i port trong docker-compose.yml
# "5440:5432"  # Thay vÃ¬ 5439
```

#### âŒ **Lá»—i: Backend khÃ´ng káº¿t ná»‘i DB**

```bash
# Kiá»ƒm tra connection string trong appsettings.json
cat src/DistributedDbApi/appsettings.json

# Äáº£m báº£o port Ä‘Ãºng:
# localhost:5439 â†’ Site 1
# localhost:5433 â†’ Site 2
# ...
```

---

### 6.4. Dá»«ng há»‡ thá»‘ng

```bash
# Dá»«ng frontend (Ctrl+C trong terminal)
^C

# Dá»«ng backend (Ctrl+C trong terminal)
^C

# Dá»«ng databases
cd Database
docker compose down

# XÃ³a hoÃ n toÃ n (bao gá»“m volumes)
docker compose down -v
```

---

## 7. Káº¾T LUáº¬N

### 7.1. ÄÃ¡nh giÃ¡ há»‡ thá»‘ng

âœ… **Æ¯u Ä‘iá»ƒm:**
- PhÃ¢n tÃ¡n dá»¯ liá»‡u rÃµ rÃ ng theo khoa
- Giáº£m chi phÃ­ truy váº¥n (80% truy váº¥n local)
- TÄƒng tÃ­nh sáºµn sÃ ng (1 site down, sites khÃ¡c váº«n hoáº¡t Ä‘á»™ng)
- Dá»… má»Ÿ rá»™ng (thÃªm khoa má»›i)
- Sá»­ dá»¥ng SAGA Pattern cho distributed transactions

âœ… **NhÆ°á»£c Ä‘iá»ƒm:**
- Truy váº¥n toÃ n cá»¥c cáº§n join nhiá»u sites (cháº­m hÆ¡n)
- Phá»©c táº¡p hÆ¡n database táº­p trung
- KhÃ´ng cÃ³ replication (single point of failure)

---

### 7.2. HÆ°á»›ng phÃ¡t triá»ƒn

ğŸ”® **TÆ°Æ¡ng lai:**
- [ ] ThÃªm read replicas cho bÃ¡o cÃ¡o
- [ ] Implement caching (Redis)
- [ ] ThÃªm authentication & authorization
- [ ] Monitoring & logging (Prometheus, Grafana)
- [ ] Auto-scaling containers
- [ ] Backup & disaster recovery

---

### 7.3. TÃ i liá»‡u tham kháº£o

- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)
- [.NET Entity Framework Core](https://docs.microsoft.com/ef/core/)
- [Next.js Documentation](https://nextjs.org/docs)
- [SAGA Pattern](https://microservices.io/patterns/data/saga.html)

---

## ğŸ“ LIÃŠN Há»†

- **TÃ¡c giáº£**: [Your Name]
- **Email**: [your.email@example.com]
- **GitHub**: [github.com/yourusername]

---

**Â© 2025 - Distributed Database Project - All Rights Reserved**
